angular.module("and-loader",[]).factory("andLoader",["$http",function(t){var o=1,s=function(t,s){this.id=o++,this.tasks=[],this.todo=[],this.parent=t||this,this.root=s||this,this.status,this.processed,this.root==this&&this.root.reset()};return s.prototype.reset=function(){this.processed=0,this.status={processed:0,loaded:0,failed:0,total:0}},s.prototype.load=function(){var t=new s(this,this.root);return this.tasks.push(t),t},s.prototype.end=function(){return this.parent},s.prototype.processTasks=function(t){for(var o in this.tasks){var s=this.tasks[o];s._run(t)}},s.prototype.run=function(t){return t&&t(this.root.status),this.root._run(t)},s.prototype._run=function(t){var o=this;for(var s in o.todo){var n=o.todo[s];o._process(n,t)}return this},s.prototype._process=function(o,s){var n=this;if(o.cust)o.cust(function(t){n._handle(t,o,!1,s)},function(t){n._handle(t,o,!0,s)});else if(o.fn){var r=o.fn.then?o.fn:o.fn();r.then(function(t){n._handle(t,o,!1,s)},function(t){n._handle(t,o,!0,s)})}else t(o).then(function(t){n._handle(t,o,!1,s)},function(t){n._handle(t,o,!0,s)})},s.prototype._handle=function(t,o,s,n){var r=this;s?r.root.status.failed++:r.root.status.loaded++,r.root.status.processed++,++r.processed==r.todo.length&&r.processTasks(n),n&&n(r.root.status),o.cb&&o.cb(t,!1)},s.prototype.get=function(t,o){return this.todo.push({url:t,method:"GET",cb:o}),this.root.status.total++,this},s.prototype.post=function(t,o,s){return this.todo.push({url:t,method:"POST",data:o,cb:s}),this.root.status.total++,this},s.prototype.res=function(t,o){return this.todo.push({fn:t,cb:o}),this.root.status.total++,this},s.prototype.cust=function(t,o){return this.todo.push({cust:t,cb:o}),this.root.status.total++,this},s.prototype.then=function(){return this.parent.load()},function(){return new s}}]);